# Archived Requirements: v1.0-analysis-complete

**Archived:** 2026-02-17
**Defined:** 2026-02-07
**Core Value:** The fairness audit is the product. Models exist to be audited, not to achieve SOTA.

## v1 Requirements — All Complete

### Environment (5/5)

- [x] **ENV-01**: Nix flake provides Python 3.12, uv, and system dependencies (OpenMP, cmake for LightGBM)
- [x] **ENV-02**: pyproject.toml declares all Python dependencies with version constraints per spec
- [x] **ENV-03**: download.py fetches ENAHO modules (02, 03, 05, 34, 37) for 2018–2024 and admin dropout CSVs
- [x] **ENV-04**: Directory structure matches spec Section 3 exactly (src/data/, src/models/, src/fairness/, etc.)
- [x] **ENV-05**: .gitignore excludes data/raw/, data/processed/, __pycache__/, .ipynb_checkpoints/

### Data Pipeline (10/10)

- [x] **DATA-01**: Load single-year ENAHO with auto-detected delimiter (pipe <=2019, comma >=2020)
- [x] **DATA-02**: Construct dropout target as (P303==1 & P306==2) with FACTOR07 survey weight preserved
- [x] **DATA-03**: Load all 6 years (2018–2023) with consistent schema and year column *(adjusted: 6 years, not 7 — ENAHO 2024 unavailable)*
- [x] **DATA-04**: Harmonize P300A mother tongue codes (collapse 10–15 -> 3 for cross-year; preserve originals)
- [x] **DATA-05**: Load and zero-pad district admin dropout rates *(synthetic data — datosabiertos 404)*
- [x] **DATA-06**: Load Census 2017 district-level enrichment data *(synthetic data)*
- [x] **DATA-07**: Load VIIRS nightlights district-level economic proxy *(synthetic data)*
- [x] **DATA-08**: Merge all sources via LEFT JOIN on UBIGEO preserving ENAHO row count
- [x] **DATA-09**: Engineer all 25 model features per spec Section 5 *(exceeded 19 minimum)*
- [x] **DATA-10**: Save intermediate datasets as parquet (enaho_merged, enaho_with_features, full_dataset)

### Descriptive Analysis (6/6)

- [x] **DESC-01**: Compute survey-weighted dropout rates by mother tongue (harmonized + Awajun disaggregated)
- [x] **DESC-02**: Compute survey-weighted dropout rates by sex x education level
- [x] **DESC-03**: Compute survey-weighted dropout rates by rural/urban, region, poverty quintile
- [x] **DESC-04**: Generate heatmap data for language x rurality interaction
- [x] **DESC-05**: Generate choropleth prep data (district-level weighted dropout rates)
- [x] **DESC-06**: Export descriptive tables to data/exports/descriptive_tables.json matching M4 schema

### Modeling (9/9)

- [x] **MODL-01**: Create temporal splits: train 2018–2021, validate 2022, test 2023 *(adjusted: 2024 unavailable)*
- [x] **MODL-02**: Train logistic regression baseline with class_weight='balanced' and survey-weighted eval
- [x] **MODL-03**: Train LightGBM with Optuna hyperparameter tuning (100 trials on validation PR-AUC)
- [x] **MODL-04**: Train XGBoost for algorithm-independence comparison (50 trials)
- [x] **MODL-05**: Calibrate best model (Platt sigmoid, 45.3% Brier reduction) on validation set
- [x] **MODL-06**: Tune threshold per model using F1 on validation; report at 0.3, 0.4, 0.5, 0.6, 0.7
- [x] **MODL-07**: Evaluate calibrated model on test set (2023) exactly once — final evaluation
- [x] **MODL-08**: Export model results to data/exports/model_results.json matching M4 schema
- [x] **MODL-09**: All metrics survey-weighted via FACTOR07; also compute unweighted and assert they differ

### Fairness Audit (6/6)

- [x] **FAIR-01**: Compute TPR, FPR, FNR, precision, PR-AUC per subgroup across 7 dimensions (added nationality)
- [x] **FAIR-02**: Compute calibration per group (actual dropout rate among predicted-high-risk >0.7 uncalibrated)
- [x] **FAIR-03**: Analyze 3 intersections: language x rurality, sex x poverty, language x region
- [x] **FAIR-04**: Flag intersectional groups with <50 unweighted observations (flagged_small_sample: true)
- [x] **FAIR-05**: Compute equalized odds gap and predictive parity gap per dimension
- [x] **FAIR-06**: Export fairness metrics to data/exports/fairness_metrics.json matching M4 schema

### SHAP Analysis (6/6)

- [x] **SHAP-01**: Compute global SHAP values using TreeExplainer on 2023 test set
- [x] **SHAP-02**: Compute regional SHAP (Costa/Sierra/Selva separately) and compare feature rankings
- [x] **SHAP-03**: Compute SHAP interaction values (1000-row subsample)
- [x] **SHAP-04**: Quantify ES_PERUANO (rank 25/25, zero) and ES_MUJER (rank 16/25, 0.003) SHAP magnitudes
- [x] **SHAP-05**: Generate 10 representative student profiles with SHAP values (diverse regions/languages)
- [x] **SHAP-06**: Export SHAP values to data/exports/shap_values.json matching M4 schema

### Cross-Validation (3/3)

- [x] **XVAL-01**: Aggregate model predictions to district level and correlate with admin dropout rates
- [x] **XVAL-02**: Compare prediction error between high-indigenous (>50%) and low-indigenous (<10%) districts
- [x] **XVAL-03**: Export choropleth data to data/exports/choropleth.json matching M4 schema (1,891 districts)

### Export (5/5)

- [x] **EXPO-01**: Export LightGBM as ONNX with prediction validation (max diff 1.03e-07 < 1e-4)
- [x] **EXPO-02**: Distill 7 media-ready findings with Spanish and English translations
- [x] **EXPO-03**: All 7 export JSON files present matching M4 site contracts
- [x] **EXPO-04**: Export README.md documenting each file's schema and provenance
- [x] **EXPO-05**: Findings ordered by impact (most striking first)

### Testing (3/3)

- [x] **TEST-01**: Gate tests for each phase validate outputs before proceeding (12 gate test files, 95 tests)
- [x] **TEST-02**: Unit tests for ENAHO loader, harmonization, UBIGEO padding
- [x] **TEST-03**: Human gate reviews at Phases 1, 4, 5, 6, 7, 8, 9, 10, 11

## Summary

- **53/53 v1 requirements complete**
- **0 dropped**
- **3 adjusted** (DATA-03: 6 years not 7; MODL-01: test=2023 not 2024; DATA-05/06/07: synthetic data)

## v2 Requirements (Deferred)

- V2-01: Automated pipeline re-run when new ENAHO year released
- V2-02: Dashboard for exploring fairness metrics interactively
- V2-03: Causal analysis (mediation/moderation) of language -> dropout pathway
- V2-04: Bias mitigation experiments (reweighting, constraint optimization)
- V2-05: Comparison with other Latin American education prediction systems
- V2-06: Censo Escolar school-level features (student-teacher ratio, infrastructure)
- V2-07: Panel tracking across ENAHO waves (if feasible)
